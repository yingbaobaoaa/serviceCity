// æ¨¡æ‹ŸAIåˆ†ææœåŠ¡
import type { CityEvent, SensorData } from '@/types'

export interface MockAnalysisResponse {
  problemAttribution: string
  disposalSuggestion: string
  priority: 'high' | 'medium' | 'low'
}

// æ¨¡æ‹Ÿåˆ†æå†…å®¹æ¨¡æ¿
const analysisTemplates = {
  // é“è·¯ç§¯æ°´ç›¸å…³
  waterLogging: {
    problemAttribution: `æ ¹æ®æ•°æ®åˆ†æï¼Œè¯¥åŒºåŸŸå‡ºç°ä¸¥é‡ç§¯æ°´çš„ä¸»è¦åŸå› åŒ…æ‹¬ï¼š

1. **æ’æ°´ç®¡ç½‘å®¹é‡ä¸è¶³**ï¼šç°æœ‰æ’æ°´ç³»ç»Ÿè®¾è®¡å®¹é‡å·²æ— æ³•æ»¡è¶³æç«¯å¤©æ°”æ¡ä»¶ä¸‹çš„æ’æ°´éœ€æ±‚ï¼Œç®¡ç½‘è€åŒ–å¯¼è‡´æ’æ°´æ•ˆç‡ä¸‹é™çº¦40%ã€‚

2. **åœ°å½¢åœ°åŠ¿å½±å“**ï¼šè¯¥åŒºåŸŸä¸ºç›¸å¯¹ä½æ´¼åœ°å¸¦ï¼Œå‘¨è¾¹åŒºåŸŸé›¨æ°´å¾„æµæ±‡é›†äºæ­¤ï¼Œå½¢æˆå¤©ç„¶ç§¯æ°´ç‚¹ã€‚æ•°æ®æ˜¾ç¤ºç§¯æ°´æ·±åº¦å·²è¾¾åˆ°60cmï¼Œè¶…å‡ºå®‰å…¨é˜ˆå€¼ã€‚

3. **æç«¯å¤©æ°”å› ç´ **ï¼šè¿‡å»24å°æ—¶é™é›¨é‡è¾¾åˆ°150mmï¼Œè¿œè¶…å†å²åŒæœŸæ°´å¹³ï¼Œå±äºç™¾å¹´ä¸€é‡çš„æç«¯é™é›¨äº‹ä»¶ã€‚

4. **åŸå¸‚ç¡¬åŒ–æ¯”ä¾‹è¿‡é«˜**ï¼šåŒºåŸŸå†…ä¸é€æ°´é¢ç§¯æ¯”ä¾‹è¾¾åˆ°85%ï¼Œé›¨æ°´ä¸‹æ¸—èƒ½åŠ›æä½ï¼Œåœ°è¡¨å¾„æµé›†ä¸­å¿«é€Ÿã€‚

ç»¼åˆè¯„ä¼°æ˜¾ç¤ºï¼Œå¦‚ä¸åŠæ—¶å¤„ç†ï¼Œç§¯æ°´å°†å¯¹äº¤é€šã€å±…æ°‘ç”Ÿæ´»å’ŒåŸºç¡€è®¾æ–½é€ æˆä¸¥é‡å½±å“ã€‚`,

    disposalSuggestion: `**åº”æ€¥å¤„ç†æªæ–½**ï¼š
- **ç«‹å³è¡ŒåŠ¨**ï¼šè°ƒåŠ¨3å°å¤§å‹æŠ½æ’æ°´è½¦ï¼ˆæµé‡500mÂ³/hï¼‰ç°åœºä½œä¸šï¼Œé¢„è®¡2å°æ—¶å†…å¯å°†ç§¯æ°´é™è‡³å®‰å…¨æ°´ä½
- **äº¤é€šç®¡åˆ¶**ï¼šå¯¹ç§¯æ°´è·¯æ®µå®æ–½ä¸´æ—¶å°é—­ï¼Œè®¾ç½®ç»•è¡Œè·¯çº¿ï¼Œé¿å…è½¦è¾†æ¶‰æ°´ç†„ç«é€ æˆæ›´å¤§æ‹¥å µ
- **äººå‘˜ç–æ•£**ï¼šå¯¹ä¸€å±‚ä½æˆ·è¿›è¡Œä¸´æ—¶ç–æ•£ï¼Œç¡®ä¿äººå‘˜å®‰å…¨

**ä¸­æœŸæ²»ç†æ–¹æ¡ˆ**ï¼š
- **ç®¡ç½‘å‡çº§**ï¼š3ä¸ªæœˆå†…å®Œæˆæ’æ°´ç®¡ç½‘æ‰©å®¹æ”¹é€ ï¼Œå°†æ’æ°´èƒ½åŠ›æå‡è‡³ç°æœ‰æ°´å¹³çš„1.5å€
- **æµ·ç»µåŸå¸‚å»ºè®¾**ï¼šå¢åŠ é€æ°´é“ºè£…ã€é›¨æ°´èŠ±å›­ç­‰æµ·ç»µè®¾æ–½ï¼Œæé«˜é›¨æ°´ä¸‹æ¸—èƒ½åŠ›
- **é¢„è­¦ç³»ç»Ÿ**ï¼šå»ºç«‹åŸºäºæ°”è±¡é¢„æŠ¥çš„ç§¯æ°´é¢„è­¦ç³»ç»Ÿï¼Œæå‰4å°æ—¶å‘å¸ƒé¢„è­¦ä¿¡æ¯

**é•¿æœŸè§„åˆ’å»ºè®®**ï¼š
- ç»“åˆåŸå¸‚æ›´æ–°æ”¹é€ ï¼Œé‡æ–°è§„åˆ’è¯¥åŒºåŸŸæ’æ°´ç³»ç»Ÿ
- å»ºè®¾åœ°ä¸‹è“„æ°´æ± ï¼Œæé«˜é›¨æ°´è°ƒè“„èƒ½åŠ›
- åŠ å¼ºä¸ä¸Šæ¸¸åŒºåŸŸåè°ƒï¼Œå®æ–½é›¨æ±¡åˆ†æµæ”¹é€ `,

    priority: 'high' as const
  },

  // è·¯ç¯æ•…éšœç›¸å…³
  streetLightFailure: {
    problemAttribution: `è·¯ç¯æ•…éšœåˆ†æç»“æœï¼š

1. **è®¾å¤‡è€åŒ–é—®é¢˜**ï¼šè¯¥æ‰¹æ¬¡è·¯ç¯å·²ä½¿ç”¨è¶…è¿‡8å¹´ï¼Œè¶…å‡ºè®¾è®¡ä½¿ç”¨å¯¿å‘½ï¼Œæ•…éšœç‡è¾ƒæ–°å»ºåŒºåŸŸé«˜å‡º300%ã€‚ä¸»è¦è¡¨ç°ä¸ºé•‡æµå™¨è€åŒ–ã€å…‰æºè¡°å‡ä¸¥é‡ã€‚

2. **ä¾›ç”µç³»ç»Ÿä¸ç¨³å®š**ï¼šæ£€æµ‹å‘ç°è¯¥è·¯æ®µç”µå‹æ³¢åŠ¨è¶…è¿‡Â±15%ï¼Œé•¿æœŸè¶…å‡ºè®¾å¤‡æ‰¿å—èŒƒå›´ï¼ŒåŠ é€Ÿäº†ç”µå™¨å…ƒä»¶çš„è€åŒ–å¤±æ•ˆã€‚

3. **ç»´æŠ¤ç®¡ç†ç¼ºå¤±**ï¼šè¿‡å»6ä¸ªæœˆå†…ï¼Œè¯¥è·¯æ®µè·¯ç¯ç»´æŠ¤è®°å½•æ˜¾ç¤ºä»…æœ‰1æ¬¡ä¾‹è¡Œæ£€æŸ¥ï¼Œæœªè¾¾åˆ°æ¯æœˆ1æ¬¡çš„ç»´æŠ¤æ ‡å‡†ã€‚

4. **ç¯å¢ƒå› ç´ å½±å“**ï¼šè¯¥è·¯æ®µé è¿‘å·¥ä¸šåŒºï¼Œç©ºæ°”ä¸­çš„è…èš€æ€§æ°”ä½“å¯¹è·¯ç¯ç”µæ°”å…ƒä»¶é€ æˆæŒç»­ä¾µèš€ï¼Œç¼©çŸ­äº†è®¾å¤‡ä½¿ç”¨å¯¿å‘½ã€‚

æ•°æ®ç»Ÿè®¡æ˜¾ç¤ºï¼Œè¯¥è·¯æ®µè·¯ç¯äº®ç¯ç‡å·²é™è‡³68%ï¼Œä¸¥é‡å½±å“å¤œé—´è¡Œè½¦å®‰å…¨ã€‚`,

    disposalSuggestion: `**ç´§æ€¥æŠ¢ä¿®æ–¹æ¡ˆ**ï¼š
- **24å°æ—¶å†…**ï¼šç»„ç»‡æŠ¢ä¿®é˜Ÿä¼æ›´æ¢æ•…éšœç¯å…·åŠç”µæ°”å…ƒä»¶ï¼Œä¼˜å…ˆä¿®å¤ä¸»è¦è·¯å£å’Œäº‹æ•…å¤šå‘è·¯æ®µ
- **ä¸´æ—¶ç…§æ˜**ï¼šåœ¨å…³é”®èŠ‚ç‚¹è®¾ç½®ç§»åŠ¨ç…§æ˜è®¾å¤‡ï¼Œä¿éšœåŸºæœ¬ç…§æ˜éœ€æ±‚

**ç³»ç»Ÿæ€§æ”¹é€ è®¡åˆ’**ï¼š
- **LEDèŠ‚èƒ½æ”¹é€ **ï¼šä¸€ä¸ªæœˆå†…å®Œæˆå…¨è·¯æ®µLEDè·¯ç¯æ”¹é€ ï¼ŒåŠŸè€—é™ä½60%ï¼Œå¯¿å‘½å»¶é•¿è‡³5ä¸‡å°æ—¶
- **æ™ºèƒ½æ§åˆ¶ç³»ç»Ÿ**ï¼šå®‰è£…æ™ºèƒ½ç›‘æ§ç³»ç»Ÿï¼Œå®ç°æ•…éšœè‡ªåŠ¨æ£€æµ‹å’ŒæŠ¥è­¦ï¼Œæé«˜ç»´æŠ¤å“åº”é€Ÿåº¦
- **ç¨³å‹è®¾å¤‡**ï¼šåŠ è£…çº¿è·¯ç¨³å‹å™¨ï¼Œç¡®ä¿ä¾›ç”µç”µå‹ç¨³å®šåœ¨é¢å®šèŒƒå›´å†…

**é¢„é˜²æ€§ç»´æŠ¤æªæ–½**ï¼š
- å»ºç«‹è·¯ç¯å¥åº·æ¡£æ¡ˆï¼Œå®æ–½é¢„é˜²æ€§ç»´æŠ¤ç­–ç•¥
- å¢åŠ å·¡æ£€é¢‘æ¬¡è‡³æ¯å‘¨1æ¬¡ï¼Œé‡ç‚¹æ£€æŸ¥ç”µæ°”è¿æ¥å’Œé˜²è…å¤„ç†
- å»ºç«‹å¤‡å“å¤‡ä»¶åº“ï¼Œç¼©çŸ­æ•…éšœä¿®å¤æ—¶é—´`,

    priority: 'medium' as const
  },

  // åƒåœ¾æ¸…è¿ç›¸å…³
  garbageOverflow: {
    problemAttribution: `åƒåœ¾æº¢å‡ºé—®é¢˜åˆ†æï¼š

1. **æ¸…è¿é¢‘ç‡ä¸è¶³**ï¼šè¯¥åŒºåŸŸäººå£å¯†åº¦è¾ƒè®¾è®¡å€¼å¢åŠ 35%ï¼Œä½†åƒåœ¾æ¸…è¿é¢‘æ¬¡ä»ä¿æŒåŸæ ‡å‡†ï¼Œå¯¼è‡´å®¹é‡ä¸¥é‡ä¸è¶³ã€‚

2. **å­£èŠ‚æ€§å› ç´ **ï¼šå¤å­£é«˜æ¸©å¯¼è‡´åƒåœ¾é‡å¢åŠ 25%ï¼ŒåŒæ—¶è…è´¥é€Ÿåº¦åŠ å¿«ï¼Œäº§ç”Ÿå¼‚å‘³é—®é¢˜ã€‚

3. **æŠ•æ”¾è¡Œä¸ºä¸å½“**ï¼šéƒ¨åˆ†å•†æˆ·è¿è§„æŠ•æ”¾å¤§ä»¶åƒåœ¾ï¼Œå ç”¨å¤§é‡æ¡¶å†…ç©ºé—´ï¼Œå½±å“æ­£å¸¸æŠ•æ”¾ã€‚

4. **è®¾æ–½å¸ƒå±€ä¸åˆç†**ï¼šç°æœ‰åƒåœ¾æ¡¶åˆ†å¸ƒä¸å‡ï¼Œéƒ¨åˆ†åŒºåŸŸæœåŠ¡åŠå¾„è¿‡å¤§ï¼Œå±…æ°‘æŠ•æ”¾ä¸ä¾¿ã€‚

ç›‘æµ‹æ•°æ®æ˜¾ç¤ºï¼Œåƒåœ¾æ¡¶å¹³å‡æ»¡æº¢ç‡è¾¾åˆ°85%ï¼Œè¿œè¶…70%çš„è­¦æˆ’çº¿ã€‚`,

    disposalSuggestion: `**ç«‹å³å¤„ç½®æªæ–½**ï¼š
- **å¢æ´¾æ¸…è¿è½¦è¾†**ï¼šä¸´æ—¶å¢åŠ 2å°æ¸…è¿è½¦ï¼Œå°†æ¸…è¿é¢‘æ¬¡æå‡è‡³æ¯æ—¥2æ¬¡
- **åŠ å¤§å®¹å™¨å®¹é‡**ï¼šåœ¨é—®é¢˜ä¸¥é‡ç‚¹ä½å¢è®¾å¤§å‹ä¸´æ—¶åƒåœ¾å®¹å™¨

**ä¼˜åŒ–è°ƒæ•´æ–¹æ¡ˆ**ï¼š
- **ç§‘å­¦è§„åˆ’å¸ƒå±€**ï¼šé‡æ–°è¯„ä¼°åƒåœ¾æ¡¶å¸ƒå±€ï¼Œç¡®ä¿æœåŠ¡åŠå¾„ä¸è¶…è¿‡100ç±³
- **æ™ºèƒ½åŒ–ç®¡ç†**ï¼šå®‰è£…åƒåœ¾æ¡¶æ»¡æº¢ä¼ æ„Ÿå™¨ï¼Œå®ç°æŒ‰éœ€æ¸…è¿ï¼Œæé«˜æ•ˆç‡
- **åˆ†ç±»æŠ•æ”¾å¼•å¯¼**ï¼šåŠ å¼ºåƒåœ¾åˆ†ç±»å®£ä¼ ï¼Œè®¾ç½®å¤§ä»¶åƒåœ¾ä¸´æ—¶å †æ”¾ç‚¹

**é•¿æ•ˆç®¡ç†æœºåˆ¶**ï¼š
- å»ºç«‹åƒåœ¾äº§ç”Ÿé‡åŠ¨æ€ç›‘æµ‹ç³»ç»Ÿ
- å®æ–½å•†æˆ·åƒåœ¾å®šæ—¶å®šé‡æŠ•æ”¾åˆ¶åº¦
- åŠ å¼ºæ‰§æ³•ç›‘ç£ï¼Œè§„èŒƒæŠ•æ”¾è¡Œä¸º`,

    priority: 'medium' as const
  },

  // å™ªéŸ³æ±¡æŸ“ç›¸å…³
  noisePollution: {
    problemAttribution: `å™ªéŸ³æ±¡æŸ“æºåˆ†æï¼š

1. **äº¤é€šå™ªéŸ³**ï¼šè¯¥è·¯æ®µä¸ºåŸå¸‚ä¸»å¹²é“ï¼Œ24å°æ—¶è½¦æµé‡è¶…è¿‡5ä¸‡è¾†ï¼Œå¤œé—´å¤§å‹è½¦è¾†æ¯”ä¾‹è¿‡é«˜ï¼Œå™ªéŸ³å³°å€¼è¾¾åˆ°85åˆ†è´ã€‚

2. **æ–½å·¥å™ªéŸ³**ï¼šå‘¨è¾¹3ä¸ªå»ºç­‘å·¥åœ°åŒæ—¶æ–½å·¥ï¼Œå¤œé—´æ–½å·¥ç°è±¡æ™®éï¼Œä¸¥é‡å½±å“å±…æ°‘ä¼‘æ¯ã€‚

3. **å•†ä¸šæ´»åŠ¨å™ªéŸ³**ï¼šæ²¿è¡—å•†é“ºéŸ³å“è®¾å¤‡éŸ³é‡è¿‡å¤§ï¼Œéƒ¨åˆ†é¤é¥®åº—å¤–æ‘†åŒºåŸŸäººå‘˜å–§å“—ï¼Œå åŠ æ•ˆåº”æ˜æ˜¾ã€‚

4. **å»ºç­‘åå°„**ï¼šä¸¤ä¾§é«˜å±‚å»ºç­‘å½¢æˆå£°éŸ³åå°„é€šé“ï¼Œå™ªéŸ³åœ¨åŸå¸‚å³¡è°·ä¸­åå¤å åŠ ï¼Œè¡°å‡ç¼“æ…¢ã€‚

è¿ç»­ç›‘æµ‹æ˜¾ç¤ºï¼Œè¯¥åŒºåŸŸå¤œé—´å™ªéŸ³è¶…æ ‡ç‡è¾¾åˆ°75%ï¼Œå·²ä¸¥é‡å½±å“å±…æ°‘ç”Ÿæ´»è´¨é‡ã€‚`,

    disposalSuggestion: `**å™ªå£°æ§åˆ¶æªæ–½**ï¼š
- **äº¤é€šç®¡ç†**ï¼šè®¾ç«‹å¤œé—´å®‰é™æ—¶æ®µï¼ˆ22:00-6:00ï¼‰ï¼Œé™åˆ¶å¤§å‹è½¦è¾†é€šè¡Œï¼Œè®¾ç½®å‡é€Ÿå¸¦é™ä½è¡Œé©¶å™ªéŸ³

- **æ–½å·¥ç›‘ç®¡**ï¼šä¸¥æ ¼æ‰§è¡Œå¤œé—´æ–½å·¥è®¸å¯åˆ¶åº¦ï¼Œè¿è§„æ–½å·¥å•ä½åˆ—å…¥é»‘åå•
- **å•†ä¸šè§„èŒƒ**ï¼šè§„èŒƒå•†é“ºéŸ³å“è®¾å¤‡ä½¿ç”¨ï¼Œé™åˆ¶å¤–æ‘†åŒºåŸŸè¥ä¸šæ—¶é—´

**å·¥ç¨‹æ²»ç†æ–¹æ¡ˆ**ï¼š
- **å£°å±éšœå»ºè®¾**ï¼šåœ¨é“è·¯ä¸¤ä¾§å®‰è£…å¸å£°éš”éŸ³å±éšœï¼Œé™ä½äº¤é€šå™ªéŸ³ä¼ æ’­
- **ç»¿åŒ–éš”ç¦»å¸¦**ï¼šç§æ¤é«˜å¤§ä¹”æœ¨å’ŒçŒæœ¨æ—å¸¦ï¼Œå½¢æˆè‡ªç„¶éš”éŸ³å±éšœ
- **å»ºç­‘æ”¹é€ **ï¼šå¯¹ä¸´è¡—å»ºç­‘è¿›è¡Œéš”éŸ³æ”¹é€ ï¼ŒåŠ è£…åŒå±‚éš”éŸ³çª—

**ç¤¾ä¼šå‚ä¸æªæ–½**ï¼š
- å»ºç«‹å™ªéŸ³æŠ•è¯‰å¿«é€Ÿå“åº”æœºåˆ¶
- å¼€å±•å®‰é™ç¤¾åŒºåˆ›å»ºæ´»åŠ¨
- åŠ å¼ºå®£ä¼ æ•™è‚²ï¼Œæé«˜å…¬ä¼—å™ªéŸ³é˜²æ²»æ„è¯†`,

    priority: 'medium' as const
  },

  // ç©ºæ°”è´¨é‡ç›¸å…³
  airQuality: {
    problemAttribution: `ç©ºæ°”è´¨é‡æ¶åŒ–åŸå› åˆ†æï¼š

1. **å·¥ä¸šæ’æ”¾å½±å“**ï¼šä¸Šé£å‘3å…¬é‡Œå¤„å·¥ä¸šå›­åŒºæ’æ”¾ï¼Œåœ¨ç‰¹å®šæ°”è±¡æ¡ä»¶ä¸‹æ±¡æŸ“ç‰©æ‰©æ•£è‡³æœ¬åŒºåŸŸã€‚PM2.5æµ“åº¦è¾ƒå‘¨è¾¹é«˜å‡º40%ã€‚

2. **äº¤é€šå°¾æ°”ç´¯ç§¯**ï¼šè¯¥åŒºåŸŸä¸ºäº¤é€šæ¢çº½ï¼Œå¤§é‡æœºåŠ¨è½¦å°¾æ°”æ’æ”¾ï¼ŒåŠ ä¹‹é“è·¯æ‹¥å µå¯¼è‡´æ€ é€Ÿæ’æ”¾å¢åŠ ã€‚

3. **æ°”è±¡æ¡ä»¶ä¸åˆ©**ï¼šè¿‘æœŸå‡ºç°é€†æ¸©å±‚ï¼Œå‚ç›´æ‰©æ•£æ¡ä»¶å·®ï¼Œæ±¡æŸ“ç‰©åœ¨è¿‘åœ°å±‚ç´¯ç§¯ï¼Œæ— æ³•æœ‰æ•ˆæ‰©æ•£ã€‚

4. **åŸå¸‚çƒ­å²›æ•ˆåº”**ï¼šåŒºåŸŸå†…ç¡¬åŒ–é¢ç§¯å¤§ï¼Œæ¸©åº¦è¾ƒå‘¨è¾¹é«˜2-3â„ƒï¼ŒåŠ å‰§äº†è‡­æ°§ç­‰äºŒæ¬¡æ±¡æŸ“ç‰©çš„ç”Ÿæˆã€‚

å®æ—¶ç›‘æµ‹æ˜¾ç¤ºï¼ŒAQIæŒ‡æ•°è¾¾åˆ°165ï¼Œå±äºä¸­åº¦æ±¡æŸ“æ°´å¹³ï¼ŒPM2.5ä¸ºä¸»è¦æ±¡æŸ“ç‰©ã€‚`,

    disposalSuggestion: `**åº”æ€¥ç®¡æ§æªæ–½**ï¼š
- **å·¥ä¸šé™äº§**ï¼šåè°ƒä¸Šé£å‘å·¥ä¸šä¼ä¸šé™äº§30%ï¼Œå‡å°‘æ±¡æŸ“ç‰©æ’æ”¾
- **äº¤é€šç®¡åˆ¶**ï¼šå®æ–½æœºåŠ¨è½¦å•åŒå·é™è¡Œï¼Œå‡å°‘å°¾æ°”æ’æ”¾
- **æ‰¬å°˜æ§åˆ¶**ï¼šå¢åŠ é“è·¯æ´’æ°´é¢‘æ¬¡ï¼Œå·¥åœ°æš‚åœåœŸæ–¹ä½œä¸š

**é•¿æœŸæ²»ç†ç­–ç•¥**ï¼š
- **äº§ä¸šå‡çº§**ï¼šæ¨åŠ¨å‘¨è¾¹å·¥ä¸šå›­åŒºè½¬å‹å‡çº§ï¼Œæ·˜æ±°è½åäº§èƒ½
- **ç»¿è‰²äº¤é€š**ï¼šå‘å±•å…¬å…±äº¤é€šï¼Œé¼“åŠ±æ–°èƒ½æºæ±½è½¦ä½¿ç”¨
- **åŸå¸‚ç»¿åŒ–**ï¼šå¢åŠ åŸå¸‚ç»¿åœ°é¢ç§¯ï¼Œæé«˜ç¯å¢ƒè‡ªå‡€èƒ½åŠ›

**é¢„è­¦ä½“ç³»å»ºè®¾**ï¼š
- å®Œå–„ç©ºæ°”è´¨é‡ç›‘æµ‹ç½‘ç»œ
- å»ºç«‹é‡æ±¡æŸ“å¤©æ°”åº”æ€¥é¢„æ¡ˆ
- åŠ å¼ºåŒºåŸŸè”é˜²è”æ§æœºåˆ¶`,

    priority: 'high' as const
  }
}

// åˆ†ææ•°æ®ï¼Œç¡®å®šæœ€é€‚åˆçš„æ¨¡æ¿
export function analyzeDataForMock(items: (CityEvent | SensorData)[]): MockAnalysisResponse {
  const eventTypes = items
    .filter(item => 'type' in item && !('sensorId' in item))
    .map(item => (item as CityEvent).type)

  const sensorTypes = items
    .filter(item => 'sensorId' in item)
    .map(item => (item as SensorData).type)

  const locations = items.map(item => item.location.district).filter((item, index, arr) => arr.indexOf(item) === index)

  // æ ¹æ®æ•°æ®ç±»å‹é€‰æ‹©åˆé€‚çš„æ¨¡æ¿
  let selectedTemplate = analysisTemplates.streetLightFailure // é»˜è®¤æ¨¡æ¿

  // ä¼˜å…ˆçº§åˆ¤æ–­é€»è¾‘
  if (eventTypes.indexOf('é“è·¯ç§¯æ°´') !== -1 || sensorTypes.indexOf('ç§¯æ°´ç›‘æµ‹') !== -1) {
    selectedTemplate = analysisTemplates.waterLogging
  } else if (eventTypes.indexOf('åƒåœ¾æº¢å‡º') !== -1 || sensorTypes.indexOf('åƒåœ¾æ¡¶æ»¡æº¢') !== -1) {
    selectedTemplate = analysisTemplates.garbageOverflow
  } else if (eventTypes.indexOf('å™ªéŸ³æ±¡æŸ“') !== -1 || sensorTypes.indexOf('å™ªéŸ³ç›‘æµ‹') !== -1) {
    selectedTemplate = analysisTemplates.noisePollution
  } else if (eventTypes.indexOf('ç©ºæ°”è´¨é‡') !== -1 || sensorTypes.indexOf('PM2.5') !== -1) {
    selectedTemplate = analysisTemplates.airQuality
  } else if (eventTypes.indexOf('è·¯ç¯æ•…éšœ') !== -1 || sensorTypes.indexOf('è·¯ç¯ç”µæµ') !== -1) {
    selectedTemplate = analysisTemplates.streetLightFailure
  }

  // åˆ›å»ºå“åº”å¯¹è±¡
  const response: MockAnalysisResponse = {
    problemAttribution: selectedTemplate.problemAttribution,
    disposalSuggestion: selectedTemplate.disposalSuggestion,
    priority: selectedTemplate.priority
  }

  // å¦‚æœæ¶‰åŠå¤šä¸ªåŒºåŸŸï¼Œå¢åŠ åè°ƒå†…å®¹
  if (locations.length > 1) {
    response.problemAttribution += `\n\n**è·¨åŒºåŸŸåè°ƒé—®é¢˜**ï¼šæœ¬æ¬¡é—®é¢˜æ¶‰åŠ${locations.join('ã€')}ç­‰å¤šä¸ªåŒºåŸŸï¼Œéœ€è¦å»ºç«‹è·¨åŒºåŸŸåè°ƒæœºåˆ¶ï¼Œç»Ÿä¸€è°ƒåº¦èµ„æºï¼Œé¿å…æ²»ç†ç›²åŒºã€‚`
    response.disposalSuggestion += `\n\n**è·¨åŒºåŸŸåä½œ**ï¼šå»ºè®®æˆç«‹ç”±å„åŒºåŸŸç›¸å…³éƒ¨é—¨ç»„æˆçš„è”åˆå·¥ä½œç»„ï¼Œåˆ¶å®šç»Ÿä¸€çš„æ²»ç†æ–¹æ¡ˆå’Œæ—¶é—´è¡¨ï¼Œç¡®ä¿åè°ƒä¸€è‡´çš„è¡ŒåŠ¨ã€‚`
  }

  return response
}

// æµå¼è¾“å‡ºæ¨¡æ‹Ÿå™¨
export async function* mockStreamingAnalysis(items: (CityEvent | SensorData)[]): AsyncGenerator<string, void, unknown> {
  const result = analyzeDataForMock(items)

  // æ„å»ºå®Œæ•´çš„è¾“å‡ºå†…å®¹
  const fullContent = `æ­£åœ¨åˆ†ææ‚¨é€‰æ‹©çš„${items.length}ä¸ªæ•°æ®é¡¹...

ğŸ“ **æ¶‰åŠåŒºåŸŸ**ï¼š${items.map(item => item.location.district).filter((item, index, arr) => arr.indexOf(item) === index).join('ã€')}

ğŸ” **åˆ†æç»“æœ**

**é—®é¢˜å½’å› **
${result.problemAttribution}

**å¤„ç½®å»ºè®®**
${result.disposalSuggestion}

**ä¼˜å…ˆçº§è¯„ä¼°**
æ ¹æ®åˆ†æç»“æœï¼Œæœ¬æ¬¡äº‹ä»¶çš„ä¼˜å…ˆçº§ä¸ºï¼š${result.priority === 'high' ? 'ğŸ”´ é«˜ä¼˜å…ˆçº§' : result.priority === 'medium' ? 'ğŸŸ¡ ä¸­ä¼˜å…ˆçº§' : 'ğŸŸ¢ ä½ä¼˜å…ˆçº§'}

---
*æœ¬åˆ†æç”±æ™ºæ…§åŸå¸‚AIåŠ©æ‰‹æä¾›*`

  // æ¨¡æ‹Ÿæ‰“å­—æœºæ•ˆæœï¼ŒæŒ‰å­—ç¬¦è¾“å‡º
  const words = fullContent.split(' ')
  let currentText = ''

  for (let i = 0; i < words.length; i++) {
    currentText += (i > 0 ? ' ' : '') + words[i]
    yield currentText

    // æ¨¡æ‹Ÿä¸åŒçš„æ‰“å­—é€Ÿåº¦
    if (words[i].indexOf('\n') !== -1) {
      await new Promise(resolve => setTimeout(resolve, 100)) // æ¢è¡Œæ—¶ç¨ä½œåœé¡¿
    } else if (words[i].indexOf('**') !== -1) {
      await new Promise(resolve => setTimeout(resolve, 50))  // åŠ ç²—æ–‡æœ¬ç¨å¿«
    } else if (i % 10 === 0) {
      await new Promise(resolve => setTimeout(resolve, 80)) // æ¯10ä¸ªè¯ç¨ä½œåœé¡¿
    } else {
      await new Promise(resolve => setTimeout(resolve, 30)) // æ­£å¸¸æ‰“å­—é€Ÿåº¦
    }
  }
}

// éæµå¼åˆ†æ
export async function mockStaticAnalysis(items: (CityEvent | SensorData)[]): Promise<MockAnalysisResponse> {
  // æ¨¡æ‹ŸAPIè°ƒç”¨å»¶è¿Ÿ
  await new Promise(resolve => setTimeout(resolve, 1500 + Math.random() * 1000))

  return analyzeDataForMock(items)
}